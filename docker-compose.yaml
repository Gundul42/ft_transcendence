version: '3.3'

services:
  nginx:
    restart: always
    depends_on:
      - backend
    image: "nginx:latest"
    ports:
      - "443:443"
      - "80:80"
    networks:
      - app
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
      - ./frontend/content:/var/www/html/content:ro

  frontend:
    restart: always
    depends_on:
      - backend
    build: "./frontend"
    image: "frontend:latest"
    networks:
      - app
    volumes:
      - ./frontend/src:/var/www/html/frontend/src

  backend:
    restart: always
    depends_on:
      - pgsql
    build: "./backend"
    image: "backend:latest"
    networks:
      - app
    volumes:
      - ./backend/src:/home/app_backend/backend/src:ro
      - ./backend/resources/tsconfig.json:/home/app_backend/backend/tsconfig.json:ro
      - ./backend/prisma/schema.prisma:/home/app_backend/backend/prisma/schema.prisma:ro
      - ./backend/resources/content:/home/app_backend/content
    environment:
      - FTAPI_URL
      - FTAPI_AUTH
      - FTAPI_TOKEN
      - FTAPI_USERDATA
      - FTAPI_CLIENTID
      - FTAPI_SECRET
      - FTAPI_REDIRECTURI
      - FTAPI_SCOPE
      - DATABASE_URL
      - JWT_SECRET

  pgsql:
    restart: always
    image: postgres:latest
#    build: ./postgres
    ports:
      - "5432:5432"
    networks:
      - app
    #volumes:
    #  - v_pgsql:/var/lib/postgresql/data
    environment:
      - POSTGRES_PASSWORD
      - POSTGRES_USER
      - POSTGRES_DB

networks:
  app:

#volumes:
#  v_pgsql: